(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e24f5"],{"7dc5":function(t,e,a){"use strict";a.r(e);var s=a("8336"),r=a("b0af"),o=a("99d9"),n=a("62ad"),i=a("a523"),l=a("8fea"),d=a("169a"),c=a("ce7e"),h=a("132d"),u=a("8e36"),p=a("0fd9"),g=a("1f4f"),_=a("2fa4"),m=a("8654"),f=a("71d9"),w=a("2a7f"),b=function(){var t=this,e=t._self._c;return e(i["a"],{attrs:{id:"optiarea-forms",fluid:"",tag:"section"}},[e(p["a"],[e(n["a"],{attrs:{cols:"1"}}),e(n["a"],{attrs:{cols:"5",md:"5"}},[e("base-material-card",{staticClass:"px-6 py-3",attrs:{color:"pink",icon:"mdi-bullseye",title:"每个输入项单位保持一致，支持精确3位小数。<br/>”边丝宽度“：卷两边的卡槽损耗的宽度。<br/>”切割宽度“：切割刀片锯片损耗宽度。（根据情况设置，没有的填”0“）",isDesc:!0,text:"<span color='white'><b>母卷设置</b></span>"}},[e(g["a"],[e("thead",[e("tr",[e("th",[t._v("#")]),e("th",[t._v("长度")]),e("th",[t._v("宽度")]),e("th",[t._v("数量")]),e("th",[t._v("重量")]),e("th",{staticClass:"text-right",attrs:{width:"20%"}},[t._v("\n                增加/减少\n              ")])])]),e("tbody",t._l(t.mode_data.parents,(function(a,r){return e("tr",{key:r},[e("td",[t._v(t._s(r+1))]),e("td",[e(m["a"],{attrs:{color:"secondary","max-width":"50",type:"number"},model:{value:a.length,callback:function(e){t.$set(a,"length",e)},expression:"parent.length"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary","max-width":"50",type:"number"},model:{value:a.width,callback:function(e){t.$set(a,"width",e)},expression:"parent.width"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary","max-width":"50",type:"number"},model:{value:a.quantity,callback:function(e){t.$set(a,"quantity",e)},expression:"parent.quantity"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary","max-width":"50",type:"number"},model:{value:a.weight,callback:function(e){t.$set(a,"weight",e)},expression:"parent.weight"}})],1),e("td",{staticClass:"text-left"},[e(s["a"],{staticClass:"px-2 ml-1",attrs:{color:"info","min-width":"0",small:""},on:{click:function(e){return t.addRowToParents()}}},[t._v("\n                  +\n                ")]),0!=r?e(s["a"],{staticClass:"px-2 ml-1",attrs:{color:"error","min-width":"0",small:""},on:{click:function(e){return t.removeRowToParents(r)}}},[t._v("\n                  -\n                ")]):t._e()],1)])})),0)]),e(p["a"],[e(n["a"],{attrs:{cols:"1"}}),e(n["a"],{attrs:{cols:"4"}},[e(m["a"],{attrs:{color:"secondary",label:"切割宽度",type:"number","prepend-icon":"mdi-zip-box-outline"},model:{value:t.cutWidth,callback:function(e){t.cutWidth=e},expression:"cutWidth"}})],1),e(n["a"],{attrs:{cols:"4"}},[e(m["a"],{attrs:{color:"secondary",label:"期望最低使用率",type:"number",suffix:"%","prepend-icon":"mdi-percent-box-outline"},model:{value:t.percent,callback:function(e){t.percent=e},expression:"percent"}})],1),e(n["a"],{attrs:{cols:"3"}},[e(o["a"],{staticClass:"pl-0 text-right"},[e(s["a"],{attrs:{color:"success","min-width":"100","max-width":"30"},on:{click:function(e){return t.selectSpec()}}},[t._v("\n                选择常用规格\n              ")])],1)],1)],1)],1)],1),e(n["a"],{attrs:{cols:"5",md:"5"}},[e("base-material-card",{staticClass:"px-6 py-3",attrs:{color:"success",icon:"mdi-format-line-weight",title:"每个输入项单位保持一致，支持精确3位小数。<br/>”按长度切割“：不需要输入重量和数量，按照长度计算多个待选方案。<br/>”按重量切割“：根据重量计算每项数量后计算最佳的方案。",isDesc:!0,text:"<span color='white'><b>分条设置</b></span>"}},[e(g["a"],[e("thead",[e("tr",[e("th",{attrs:{width:"4%"}},[t._v("#")]),e("th",[t._v("长度")]),e("th",[t._v("宽度")]),e("th",[t._v("预定重量")]),e("th",[t._v("数量")]),e("th",{staticClass:"text-right",attrs:{width:"20%"}},[t._v("\n                增加/减少\n              ")])])]),e("tbody",t._l(t.mode_data.childs,(function(a,r){return e("tr",{key:r},[e("td",{style:t.getColor(a.color)},[t._v(t._s(r+1))]),e("td",[e(m["a"],{attrs:{color:"secondary",type:"number","max-width":"10"},model:{value:a.length,callback:function(e){t.$set(a,"length",e)},expression:"child.length"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary",type:"number","max-width":"10"},model:{value:a.width,callback:function(e){t.$set(a,"width",e)},expression:"child.width"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary",type:"number","max-width":"50"},model:{value:a.weight,callback:function(e){t.$set(a,"weight",e)},expression:"child.weight"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary",type:"number","max-width":"50"},on:{change:function(t){}},model:{value:a.quantity,callback:function(e){t.$set(a,"quantity",e)},expression:"child.quantity"}})],1),e("td",{staticClass:"text-left"},[e(s["a"],{staticClass:"px-2 ml-1",attrs:{color:"info","min-width":"0",small:""},on:{click:function(e){return t.addRowToChilds()}}},[t._v("\n                  +\n                ")]),0!=r?e(s["a"],{staticClass:"px-2 ml-1",attrs:{color:"error","min-width":"0",small:""},on:{click:function(e){return t.removeRowToChilds(r)}}},[t._v("\n                  -\n                ")]):t._e()],1)])})),0)]),e(p["a"],{staticClass:"text-right"},[e(n["a"],{attrs:{cols:"3"}}),e(n["a"],{attrs:{cols:"3"}},[e(o["a"],{staticClass:"pl-0 text-right"},[e(s["a"],{attrs:{color:"success",disabled:t.cutBtnDisabled},on:{click:function(e){return t.sendCutRule()}}},[t._v("\n                按规格切割\n              ")])],1)],1),e(n["a"],{attrs:{cols:"3"}},[e(o["a"],{staticClass:"pl-0 text-right"},[e(s["a"],{attrs:{color:"success",disabled:t.cutBtnDisabled},on:{click:function(e){return t.sendCutSheet("weight")}}},[t._v("\n                按重量切割\n              ")])],1)],1),e(n["a"],{attrs:{cols:"3"}},[e(o["a"],{staticClass:"pl-0 text-right"},[e(s["a"],{attrs:{color:"success",disabled:t.cutBtnDisabled},on:{click:function(e){return t.sendCutSheet("quantity")}}},[t._v("\n                按数量切割\n              ")])],1)],1)],1)],1)],1),e(n["a"],{attrs:{cols:"1"}})],1),t.mode_data.childs_for_select&&t.mode_data.childs_for_select.length>0?e(p["a"],{staticStyle:{"margin-top":"-40px"}},[e(n["a"],{attrs:{cols:"1"}}),e(n["a"],{attrs:{cols:"10",md:"10"}},[e("base-material-card",{staticClass:"px-5 py-3",attrs:{color:"pink",icon:"mdi-format-line-style",text:"<span color='white'><b>待选方案</b></span>"}},[e(p["a"],t._l(t.mode_data.childs_for_select,(function(a,s){return e(n["a"],{key:s,attrs:{cols:"3"}},[e(g["a"],{staticClass:"theme--dark",attrs:{dense:""},on:{mouseover:function(e){return t.hoverPlan(t.i)}}},[e("thead",[e("tr",[e("th",[t._v("#")]),e("th",[t._v("长度")]),e("th",[t._v("宽度")]),e("th",[t._v("数量")])])]),e("thead",[e("tr",{staticClass:"border"},[e("td",[t._v("#")]),e("td",{attrs:{colspan:"2"}},[t._v("损耗面积")]),e("td",[t._v("\n                    "+t._s(a.solutions.solutions[0].unused_area/1e3/1e3)+"\n                  ")])])]),e("tbody",t._l(a.sub_child_solver,(function(a,s){return e("tr",{key:s},[e("td",[t._v(t._s(s+1))]),e("td",[t._v("\n                    "+t._s(a.length/1e3)+"\n                  ")]),e("td",[t._v("\n                    "+t._s(a.width/1e3)+"\n                  ")]),e("td",[t._v("\n                    "+t._s(a.quantity)+"\n                  ")])])})),0)]),e("div",{staticClass:"text-center",staticStyle:{"margin-top":"-10px","z-index":"1"}},[e("pages-btn",{attrs:{color:a.select?"success":"info",small:"",depressed:"","min-width":"50"},on:{click:function(e){return t.selectdRow(s)}}},[t._v("\n                "+t._s("选我")+"\n              ")])],1)],1)})),1)],1)],1),e(n["a"],{attrs:{cols:"1"}})],1):t._e(),e(p["a"],{staticStyle:{"margin-top":"-40px"}},[e(n["a"],{attrs:{cols:"1"}}),e(n["a"],{attrs:{cols:"10",md:"10"}},[e("base-material-card",{staticClass:"px-5 py-3",attrs:{color:"pink",icon:"mdi-format-line-style",title:"分割方案",text:"<span color='white'><b>分割方案</b></span>"}},[e(g["a"],[e("thead",[e("tr",[e("th",{attrs:{width:"4%"}},[t._v("#")]),e("th",[e("b",[t._v("有效面积")])]),e("th",[e("b",[t._v("有效重量")])]),e("th",[e("b",[t._v("使用率")])]),e("th",[e("b",[t._v("损耗面积")])]),e("th",[e("b",[t._v("损耗重量")])]),e("th",{attrs:{width:"50%"}},[e("b",[t._v("明细(规格*数量/重量)")])])])]),t.mode_data.result?e("tbody",t._l(t.mode_data.result.data.solutions,(function(a,s){return e("tr",{key:s},[e("td",[t._v(t._s(s+1))]),e("td",[t._v("\n                "+t._s(t.getRound(a.used_area,!0))+"\n              ")]),e("td",[t._v("\n                "+t._s(t.getRound(a.used_weight,!1))+"\n              ")]),e("td",[t._v("\n                "+t._s(t.getPercentageUtilization(parseFloat(a.unused_area),parseFloat(a.used_area)))+"%\n              ")]),e("td",[t._v("\n                "+t._s(t.getRound(a.unused_area,!0))+"\n              ")]),e("td",[t._v("\n                "+t._s(t.getRound(a.unused_weight,!1))+"\n              ")]),e("td",[t._v("\n                "+t._s(a.subs_list.join(","))+"\n              ")])])})),0):t._e()]),e(p["a"],{staticClass:"text-right"},[e(n["a"],{attrs:{cols:"5"}}),e(n["a"],{attrs:{cols:"3"}},[e(o["a"],{staticClass:"pl-0 text-right"},[e(s["a"],{attrs:{color:"success",disabled:t.cutBtnDisabled},on:{click:function(e){return t.downloadCsv()}}},[t._v("\n                下载\n              ")])],1)],1),e(n["a"],{attrs:{cols:"4"}})],1),e(p["a"],{staticStyle:{"margin-top":"-20px"}},[e(n["a"],{attrs:{cols:"3"}},[e("div",{attrs:{id:"d3_area_1"}},[e("svg",{staticStyle:{height:"300"}})])]),e(n["a"],{attrs:{cols:"3"}},[e("div",{attrs:{id:"d3_area_2"}},[e("svg",{staticStyle:{height:"300"}})])]),e(n["a"],{attrs:{cols:"3"}},[e("div",{attrs:{id:"d3_area_3"}},[e("svg",{staticStyle:{height:"300"}})])]),e(n["a"],{attrs:{cols:"3"}},[e("div",{attrs:{id:"d3_area_4"}},[e("svg",{staticStyle:{height:"300"}})])])],1)],1)],1),e(n["a"],{attrs:{cols:"1"}})],1),e("base-material-snackbar",t._b({attrs:{timeout:2e3,type:t.color},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},"base-material-snackbar",{top:!0,center:!0},!1),[e("span",{staticClass:"font-weight-bold"},[t._v(t._s(t.snackbarMsg))])]),e(d["a"],{attrs:{scrim:!1,persistent:"",width:"auto"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e(r["a"],{attrs:{color:"success"}},[e(o["b"],[e("span",{staticClass:"white--text font-weight-bold"},[e("b",[t._v("请稍后，计算中...")])]),e(u["a"],{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),e(d["a"],{attrs:{scrollable:"",width:"400"},model:{value:t.dialogSelect,callback:function(e){t.dialogSelect=e},expression:"dialogSelect"}},[e(r["a"],[e(f["a"],{attrs:{color:"info"}},[e(w["a"],[t._v("选择常用规格")]),e(_["a"]),e(s["a"],{staticClass:"px-2 ml-1",attrs:{small:"",color:"info",variant:"text"},on:{click:function(e){t.dialogAdd=!0}}},[e(h["a"],{attrs:{color:"white"}},[t._v("mdi-plus")])],1)],1),e(c["a"]),e(l["a"],{attrs:{headers:t.headers,items:t.selections,"hide-default-footer":"","show-select":""},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),e(c["a"]),e(o["a"],[e(s["a"],{attrs:{color:"success",variant:"text"},on:{click:function(e){return t.selectedSpec()}}},[t._v("\n          确定\n        ")]),e(s["a"],{attrs:{color:"blue-darken-1",variant:"text"},on:{click:function(e){t.dialogSelect=!1}}},[t._v("\n          关闭\n        ")]),e(_["a"]),e(s["a"],{attrs:{color:"error",align:"right",variant:"text"},on:{click:function(e){return t.delSpec()}}},[t._v("\n          删除\n        ")])],1)],1)],1),e(d["a"],{attrs:{scrollable:"",width:"300"},model:{value:t.dialogAdd,callback:function(e){t.dialogAdd=e},expression:"dialogAdd"}},[e(r["a"],[e(f["a"],{attrs:{color:"info"}},[e(w["a"],[t._v("添加常用规格")]),e(_["a"])],1),e(c["a"]),e(p["a"],[e(n["a"],{attrs:{cols:"1"}}),e(n["a"],{attrs:{cols:"10"}},[e(m["a"],{attrs:{width:"80%",label:"长度",color:"secondary",type:"number"},model:{value:t.addSpecInfo.length,callback:function(e){t.$set(t.addSpecInfo,"length",e)},expression:"addSpecInfo.length"}}),e(m["a"],{attrs:{width:"80%",label:"宽度",color:"secondary",type:"number"},model:{value:t.addSpecInfo.width,callback:function(e){t.$set(t.addSpecInfo,"width",e)},expression:"addSpecInfo.width"}}),e(m["a"],{attrs:{width:"80%",label:"重量",color:"secondary",type:"number"},model:{value:t.addSpecInfo.weight,callback:function(e){t.$set(t.addSpecInfo,"weight",e)},expression:"addSpecInfo.weight"}})],1),e(n["a"],{attrs:{cols:"1"}})],1),e(c["a"]),e(o["a"],[e(s["a"],{attrs:{color:"success",variant:"text"},on:{click:function(e){return t.addSpec()}}},[t._v("\n          添加\n        ")]),e(s["a"],{attrs:{color:"blue-darken-1",variant:"text"},on:{click:function(e){t.dialogAdd=!1}}},[t._v("\n          关闭\n        ")])],1)],1)],1)],1)},v=[],y=a("898b"),x=a("7c15"),k={name:"OptiAreaPage",components:{PagesBtn:()=>a.e("chunk-2d22e0db").then(a.bind(null,"f9b4"))},data:()=>({dialogAdd:!1,dialogSelect:!1,dialog:!1,cutWidth:0,percent:99,snackbar:!1,color:"info",snackbarMsg:"",side:0,selected:[],cutBtnDisabled:!1,mode_data:{childs:[{length:0,width:0,quantity:0,weight:0,color:""}],parents:[{length:0,width:0,quantity:0,weight:0}],result:null,childs_for_select:null},addSpecInfo:{spec_type:"ParentArea",length:0,width:0,weight:0},selections:[],headers:[{text:"长度",value:"length"},{text:"宽度",value:"width"},{text:"重量",value:"weight"}],colors:["#FF5722","#E65100","#FFC107","#388E3C","#DCE775","#0277BD","#80D8FF","#0288D1","#26A69A","#26C6DA","#651FFF","#7E57C2","#5C6BC0","#8e44ad","#EF5350","#8E24AA","#AA00FF","#2196F3","#1E88E5","#795548","#FF9E80","#f1c40f","#1abc9c","#f39c12","#2ecc71","#27ae60","#e67e22","#d35400","#16a085","#3498db","#2980b9","#e74c3c","#c0392b","#9b59b6","#8e44ad","#ecf0f1","#bdc3c7","#95a5a6","#34495e","#2c3e50"]}),created(){this.$vuetify.theme.dark=!1},destroyed(){this.$vuetify.theme.dark=!0},methods:{getRound:function(t,e){return e?Math.round(Math.round(parseFloat(t))/1e3)/1e3:Math.round(parseFloat(t))/1e3},getPercentageUtilization:function(t,e){let a=100*e/(t+e);return a*=100,a=Math.round(a),a/=100,a},getColor:function(t){return{backgroundColor:""+t}},disableCutBtn:function(t){this.cutBtnDisabled=t},alertErr:function(t,e){this.snackbar=!0,this.color=t,this.snackbarMsg=e},hoverPlan(t){let e=0;this.childs_for_select.forEach(a=>{a.select=t===e,e++})},addSpec:function(){this.addSpecInfo.length=parseFloat(this.addSpecInfo.length),this.addSpecInfo.width=parseFloat(this.addSpecInfo.width),this.addSpecInfo.weight=parseFloat(this.addSpecInfo.weight),Object(x["i"])(this.addSpecInfo).then(t=>{if(this.dialogAdd=!1,0==t.code)return this.getSelections(),void(this.selected=[]);this.alertErr("error",t.msg)}).catch(t=>(this.dialogAdd=!1,this.alertErr("error",t.message),!1))},selectSpec:function(){this.dialogSelect=!0,this.getSelections()},selectedSpec:function(){this.dialogSelect=!1,0==this.mode_data.parents[0].length&&(this.mode_data.parents=[]),this.selected.forEach(t=>{this.mode_data.parents.push({length:t.length,width:t.width,quantity:1,weight:t.weight})})},getSelections:function(){Object(x["b"])({}).then(t=>{if(console.log(t),0==t.code)return this.selections=[],void t.data.forEach(t=>this.selections.push(t));this.alertErr("error",t.msg)}).catch(t=>(this.alertErr("error",t.message),!1))},selectdRow:function(t){this.selectedSolIndex=!0;let e=this.mode_data.childs_for_select[t];for(let a=0;a<e.sub_child_solver.length;a++){const t=e.sub_child_solver[a];this.mode_data.childs[a].quantity=t.quantity}this.rule_selectd_index=t,this.mode_data.result={data:{solutions:null,sub_weights:null}},this.mode_data.result.data.solutions=this.mode_data.childs_for_select[t].solutions.solutions,this.displayResult(),this.mode_data.childs_for_select[t].solutions.solutions.computed=!0},addRowToChilds:function(){this.mode_data.childs.push({length:0,width:0,quantity:0,weight:0})},removeRowToChilds:function(t){this.mode_data.childs.splice(t,1)},addRowToParents:function(){this.mode_data.parents.push({length:0,width:0,quantity:0,weight:0})},removeRowToParents:function(t){this.mode_data.parents.splice(t,1)},prepareDataToSend2DForWeight:function(t){let e=[],a=0,s=0,r=0;this.mode_data.parents.forEach(t=>{s+=parseFloat(t.width)*parseFloat(t.length)*parseInt(t.quantity),a+=parseFloat(t.weight)*parseInt(t.quantity),e.push({quantity:parseInt(t.quantity),width:1e3*parseFloat(t.width),length:1e3*parseFloat(t.length),weight:parseInt(1e3*parseFloat(t.weight))})});let o=a/s,n=[];return this.mode_data.childs.forEach(e=>{let a=parseFloat(e.width)*parseFloat(e.length);if("weight"==t){let t=parseInt(parseFloat(e.weight)/(a*o));e.quantity=t}r+=a*e.quantity,n.push({quantity:parseInt(e.quantity),width:parseInt(1e3*parseFloat(e.width)),length:parseInt(1e3*parseFloat(e.length))})}),r>=s?(this.alertErr("error","需要切割的数量过大，超过母板的总面积，请修改需要切割重量或数量！"),!1):(r>=.95*s&&this.alertErr("warning","需要切割的数量过大，超过母板的总面积的95%，有可能会没有最优解！"),{child_areas:n,parent_areas:e,side:parseInt(1e3*parseFloat(this.cutWidth)),seed:Math.round(10*Math.random()),percent:this.percent})},prepareDataToSend2DForRule:function(){let t=[];this.mode_data.parents.forEach(e=>{t.push({quantity:parseInt(e.quantity),width:1e3*parseFloat(e.width),length:1e3*parseFloat(e.length),weight:parseInt(1e3*parseFloat(e.weight))})});let e=[];return this.mode_data.childs.forEach(t=>{e.push({width:parseInt(1e3*parseFloat(t.width)),length:parseInt(1e3*parseFloat(t.length))})}),{child_areas:e,parent_areas:t,side:parseInt(1e3*parseFloat(this.cutWidth)),seed:Math.round(10*Math.random()),percent:this.percent}},sendCutSheet:function(t){this.clearTheDrawing(),this.mode_data.result=null,this.mode_data.childs_for_select=[],this.cutRules=!1;for(let a=0;a<this.mode_data.parents.length;a++){const t=this.mode_data.parents[a];if(null==t.length||0==t.length)return this.alertErr("error","请输入母卷的长度！"),!1;if(null==t.width||0==t.width)return this.alertErr("error","请输入母卷的宽度！"),!1;if(null==t.weight||0==t.weight)return this.alertErr("error","请输入母卷的重量！"),!1;if(null==t.quantity||0==t.quantity)return this.alertErr("error","请输入母卷的数量！"),!1}for(let a=0;a<this.mode_data.childs.length;a++){const e=this.mode_data.childs[a];if(null==e.length||0==e.length)return this.alertErr("error","请输入子卷的长度！"),!1;if(null==e.width||0==e.width)return this.alertErr("error","请输入子卷的宽度！"),!1;if("weight"==t&&(null==e.weight||0==e.weight))return this.alertErr("error","请输入子卷的重量！"),!1;if("quantity"==t&&(null==e.quantity||0==e.quantity))return this.alertErr("error","请输入子卷数量！"),!1}const e=this.prepareDataToSend2DForWeight(t);0!=e&&(console.log(e),this.disableCutBtn(!0),this.dialog=!0,Object(x["m"])(e).then(t=>{if(console.log(t),this.dialog=!1,this.disableCutBtn(!1),0==t.code)return t.data&&t.data.status_name&&"Error"==t.data.status_name?(this.alertErr("error","服务计算超出母卷的面积，请修改子卷重量或数量后重试！"),!1):(this.mode_data.result=t,this.mode_data.result&&this.mode_data.result.status_name&&(this.mode_data.result.statusName=this.mode_data.result.status_name.toLowerCase()),void this.displayResult());this.alertErr("error",t.msg)}).catch(t=>(this.dialog=!1,console.log(t),this.disableCutBtn(!1),this.alertErr("error","连接服务失败，请检查网络"),!1)))},sendCutRule:function(){this.clearTheDrawing(),this.mode_data.result=null,this.mode_data.childs_for_select=[],this.cutRules=!1;for(let e=0;e<this.mode_data.parents.length;e++){const t=this.mode_data.parents[e];if(null==t.length||0==t.length)return this.alertErr("error","请输入母卷的长度！"),!1;if(null==t.width||0==t.width)return this.alertErr("error","请输入母卷的宽度！"),!1;if(null==t.weight||0==t.weight)return this.alertErr("error","请输入母卷的重量！"),!1;if(null==t.quantity||0==t.quantity)return this.alertErr("error","请输入母卷的数量！"),!1}for(let e=0;e<this.mode_data.childs.length;e++){const t=this.mode_data.childs[e];if(null==t.length||0==t.length)return this.alertErr("error","请输入子卷的长度！"),!1;if(null==t.width||0==t.width)return this.alertErr("error","请输入子卷的宽度！"),!1}if(this.percent<90&&this.alertErr("warning","期望最小使用率有点低哦！"),this.percent>=100)return this.alertErr("error","期望最小使用率太高了哦！做不到"),!1;const t=this.prepareDataToSend2DForRule();0!=t&&(console.log(t),this.disableCutBtn(!0),this.dialog=!0,Object(x["l"])(t).then(t=>{console.log(t),this.dialog=!1,this.disableCutBtn(!1),0!=t.code?this.alertErr("error",t.msg):this.displayRulesResult(t)}).catch(t=>(this.dialog=!1,console.log(t),this.disableCutBtn(!1),this.alertErr("error","连接服务失败，请检查网络"),!1)))},displayResult:function(){let t=[];this.mode_data.result.data.solutions.forEach(e=>{console.log(e);let a=[],s=[],r=1e3;e.subs.forEach(t=>{let o=!1;if(s.forEach(a=>{if(a.area==this.getRound(t.width,!1)*this.getRound(t.length,!1)){let s=this.getRound(t.width,!1)*this.getRound(t.length,!1)/this.getRound(e.used_area,!0)*this.getRound(e.used_weight,!1);a.number+=1,a.weight+=Math.round(s*r)/r,o=!0}}),0==o){let a=this.getRound(t.width,!1)*this.getRound(t.length,!1)/this.getRound(e.used_area,!0)*this.getRound(e.used_weight,!1);s.push({area:this.getRound(t.width,!1)*this.getRound(t.length,!1),key:this.getRound(t.length,!1)+"X"+this.getRound(t.width,!1),number:1,weight:Math.round(a*r)/r})}let n={x1:this.getRound(t.x,!1),y1:this.getRound(t.y,!1),x2:this.getRound(t.x,!1)+this.getRound(t.width,!1),y2:this.getRound(t.y,!1)+this.getRound(t.length,!1)};a.push(n)});let o=[];s.forEach(t=>{o.push(t.key+"*"+t.number+"/"+Math.round(parseFloat(t.weight)*r)/r)}),e.subs_list=o,t.push(a)}),this.mode_data.result.solutions=t,this.draw2d()},displayRulesResult:function(t){t&&t.status_name&&(this.mode_data.result.statusName=t.data.status_name.toLowerCase()),t.data.solutions&&t.data.solutions.length>0&&(this.mode_data.childs_for_select=t.data.solutions)},draw2d:function(){if(this.clearTheDrawing(),this.mode_data.childs.forEach(t=>{let e=Math.round(Math.random()*this.colors.length);t.color=this.colors[e]}),!this.mode_data.result)return void console.log(`Cannot draw anything. "result" is: ${this.mode_data.result} for mode: ${this.mode}`);const t=this.mode_data.result.solutions;for(let e=0;e<t.length;e++){const a=t[e];for(let t=0;t<a.length;t++){const s=a[t];let r=parseFloat(s.x1),o=parseFloat(s.y1),n=parseFloat(s.x2),i=parseFloat(s.y2),l="";this.mode_data.childs.forEach(t=>{(parseInt(t.width)==parseInt(i-o)&&parseInt(t.length)==parseInt(n-r)||parseInt(t.width)==parseInt(n-r)&&parseInt(t.length)==parseInt(i-o))&&""==l&&(l=t.color)}),this.drawRect(r,o,n,i,l,e+1)}}},clearTheDrawing:function(){y["e"]("#d3_area_1 svg > *").remove(),y["d"]("#d3_area_1 svg").style("border",""),y["e"]("#d3_area_2 svg > *").remove(),y["d"]("#d3_area_2 svg").style("border",""),y["e"]("#d3_area_3 svg > *").remove(),y["d"]("#d3_area_3 svg").style("border",""),y["e"]("#d3_area_4 svg > *").remove(),y["d"]("#d3_area_4 svg").style("border","")},drawRect:function(t,e,a,s,r,o){const n=Math.abs(parseFloat(a)-parseFloat(t)),i=Math.abs(parseFloat(s)-parseFloat(e)),l=parseFloat(this.mode_data.parents[0].width),d=parseFloat(this.mode_data.parents[0].length);let c=y["c"]().domain([0,l]).range([0,300]),h=y["c"]().domain([0,d]).range([0,300]),u="#d3_area_"+o+" svg",p=y["d"](u);console.log(p);var g={top:0,right:0,bottom:0,left:0};let _=300-g.left-g.right,m=300-g.top-g.bottom,f=p.attr("width",_+g.left+g.right).attr("height",m+g.top+g.bottom).style("border","1px solid #34495e").append("g").attr("transform","translate("+g.left+","+g.top+")");f.append("rect").style("fill",r).attr("x",c(t)).attr("y",h(e)).attr("width",c(n)).attr("height",h(i)).attr("stroke","#34495e").text(`${n} x ${i}`);const w=c(t)+Math.abs(c(n)/2),b=h(e)+Math.abs(h(i)/2);f.append("text").attr("x",w).attr("y",b).attr("stroke","#34495e").attr("stroke","black")},downloadCsv:function(){if(!this.mode_data.result||!this.mode_data.result.solutions)return void console.log("downloadCsv: bigRolls are empty..");let t=[["序号","有效面积","有效重量","使用率","损耗面积","损耗重量","明细（规格*数量/重量）"]],e=0;const a=this.mode_data.result.data.solutions;for(let d=0;d<a.length;d++){const e=[d+1,a[d].used_area,a[d].used_weight,this.getPercentageUtilization(parseFloat(a[d].unused_area),parseFloat(a[d].used_area))+"%",a[d].unused_area,a[d].unused_weight,a[d].subs_list.join(",")];t.push(e)}const s="data:text/csv;charset=utf-8,"+t.map(t=>t.join(",")).join("\n");let r=encodeURI(s),o=document.createElement("a");o.setAttribute("href",r);const n=new Date,i=`${n.getFullYear()}-${n.getMonth()+1}-${n.getUTCDate()}-${n.getHours()}${n.getMinutes()}-${n.getSeconds()}`,l=`cuts_${e}_${i}.csv`;o.setAttribute("download",l),document.body.appendChild(o),o.click()}}},C=k,F=a("2877"),E=Object(F["a"])(C,b,v,!1,null,null,null);e["default"]=E.exports}}]);
//# sourceMappingURL=chunk-2d0e24f5.82f8dd56.js.map