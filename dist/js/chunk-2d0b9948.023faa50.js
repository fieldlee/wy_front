(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b9948"],{"340a":function(t,e,a){"use strict";a.r(e);var s=a("8336"),o=a("b0af"),i=a("99d9"),r=a("62ad"),l=a("a523"),n=a("8fea"),d=a("169a"),c=a("ce7e"),h=a("132d"),u=a("8e36"),p=a("0fd9"),_=a("1f4f"),f=a("2fa4"),m=a("8654"),g=a("71d9"),w=a("2a7f"),b=function(){var t=this,e=t._self._c;return e(l["a"],{attrs:{id:"opti1d-forms",fluid:"",tag:"section"}},[e(p["a"],[e(r["a"],{attrs:{cols:"1"}}),e(r["a"],{attrs:{cols:"5",md:"5"}},[e("base-material-card",{staticClass:"px-6 py-3",attrs:{color:"pink",icon:"mdi-bullseye",title:"每个输入项单位保持一致，支持精确3位小数。<br/>”边丝宽度“：卷两边的卡槽损耗的宽度。（根据情况设置，没有的填”0“）",isDesc:!0,text:"<span color='white'><b>母卷设置</b></span>"}},[e(_["a"],[e("thead",[e("tr",[e("th",[t._v("#")]),e("th",[t._v("长度")]),e("th",[t._v("数量")]),e("th",[t._v("重量")]),e("th",{staticClass:"text-right",attrs:{width:"20%"}},[t._v("\n                                增加/减少\n                            ")])])]),e("tbody",t._l(t.mode_data.parents,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(o+1))]),e("td",[e(m["a"],{attrs:{color:"secondary","max-width":"50",type:"number"},model:{value:a.width,callback:function(e){t.$set(a,"width",e)},expression:"parent.width"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary","max-width":"50",type:"number"},model:{value:a.quantity,callback:function(e){t.$set(a,"quantity",e)},expression:"parent.quantity"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary","max-width":"50",type:"number"},model:{value:a.weight,callback:function(e){t.$set(a,"weight",e)},expression:"parent.weight"}})],1),e("td",{staticClass:"text-left"},[e(s["a"],{staticClass:"px-2 ml-1",attrs:{color:"info","min-width":"0",small:""},on:{click:function(e){return t.addRowToParents()}}},[t._v("\n                                    +\n                                ")]),0!=o?e(s["a"],{staticClass:"px-2 ml-1",attrs:{color:"error","min-width":"0",small:""},on:{click:function(e){return t.removeRowToParents(o)}}},[t._v("\n                                    -\n                                ")]):t._e()],1)])})),0)]),e(p["a"],[e(r["a"],{attrs:{cols:"1"}}),e(r["a"],{attrs:{cols:"4"}},[e(m["a"],{attrs:{color:"secondary",label:"边丝宽度",type:"number","prepend-icon":"mdi-arrow-expand-horizontal"},model:{value:t.side,callback:function(e){t.side=e},expression:"side"}})],1),e(r["a"],{attrs:{cols:"4"}},[e(m["a"],{attrs:{color:"secondary",label:"期望最低使用率",type:"number",suffix:"%","prepend-icon":"mdi-percent-box-outline"},model:{value:t.percent,callback:function(e){t.percent=e},expression:"percent"}})],1),e(r["a"],{attrs:{cols:"3"}},[e(i["a"],{staticClass:"pl-0 text-right"},[e(s["a"],{attrs:{color:"success","min-width":"100","max-width":"30"},on:{click:function(e){return t.selectSpec()}}},[t._v("\n                                选择常用规格\n                            ")])],1)],1)],1)],1)],1),e(r["a"],{attrs:{cols:"5",md:"5"}},[e("base-material-card",{staticClass:"px-6 py-3",attrs:{color:"success",icon:"mdi-format-line-weight",title:"每个输入项单位保持一致，支持精确3位小数。<br/>”按长度切割“：不需要输入重量和数量，按照长度计算多个待选方案。<br/>”按预定重量切割“：根据客户预定重量计算每项数量后计算最佳的方案。",isDesc:!0,text:"<span color='white'><b>分条设置</b></span>"}},[e(_["a"],[e("thead",[e("tr",[e("th",{attrs:{width:"4%"}},[t._v("#")]),e("th",[t._v("长度")]),e("th",[t._v("预定重量")]),e("th",[t._v("数量")]),e("th",{staticClass:"text-right",attrs:{width:"20%"}},[t._v("\n                                增加/减少\n                            ")])])]),e("tbody",t._l(t.mode_data.childs,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(o+1))]),e("td",[e(m["a"],{attrs:{color:"secondary",type:"number","max-width":"10"},model:{value:a.width,callback:function(e){t.$set(a,"width",e)},expression:"child.width"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary",type:"number","max-width":"50"},model:{value:a.weight,callback:function(e){t.$set(a,"weight",e)},expression:"child.weight"}})],1),e("td",[e(m["a"],{attrs:{color:"secondary",type:"number","max-width":"50"},model:{value:a.quantity,callback:function(e){t.$set(a,"quantity",e)},expression:"child.quantity"}})],1),e("td",{staticClass:"text-left"},[e(s["a"],{staticClass:"px-2 ml-1",attrs:{color:"info","min-width":"0",small:""},on:{click:function(e){return t.addRowToChilds()}}},[t._v("\n                                    +\n                                ")]),0!=o?e(s["a"],{staticClass:"px-2 ml-1",attrs:{color:"error","min-width":"0",small:""},on:{click:function(e){return t.removeRowToChilds(o)}}},[t._v("\n                                    -\n                                ")]):t._e()],1)])})),0)]),e(p["a"],{staticClass:"text-right"},[e(r["a"],{attrs:{cols:"5"}}),e(r["a"],{attrs:{cols:"3"}},[e(i["a"],{staticClass:"pl-0 text-right"},[e(s["a"],{attrs:{color:"success",disabled:t.cutBtnDisabled},on:{click:function(e){return t.sendCutRules()}}},[t._v("\n                                按长度切割\n                            ")])],1)],1),e(r["a"],{attrs:{cols:"4"}},[e(i["a"],{staticClass:"pl-0 text-right"},[e(s["a"],{attrs:{color:"success",disabled:t.cutBtnDisabled},on:{click:function(e){return t.sendCutSheet()}}},[t._v("\n                                按预定重量切割\n                            ")])],1)],1)],1)],1)],1),e(r["a"],{attrs:{cols:"1"}})],1),t.mode_data.childs_for_select&&t.mode_data.childs_for_select.length>0?e(p["a"],{staticStyle:{"margin-top":"-40px"}},[e(r["a"],{attrs:{cols:"1"}}),e(r["a"],{attrs:{cols:"10",md:"10"}},[e("base-material-card",{staticClass:"px-5 py-3",attrs:{color:"pink",icon:"mdi-format-line-style",text:"<span color='white'><b>待选方案</b></span>"}},[e(p["a"],t._l(t.mode_data.childs_for_select,(function(a,s){return e(r["a"],{key:s,attrs:{cols:"2"}},[e(_["a"],{staticClass:"theme--dark font-weight-bold",attrs:{dense:""},on:{mouseover:function(e){return t.hoverPlan(t.i)}}},[e("thead",[e("tr",[e("th",[t._v("#")]),e("th",[t._v("宽度")]),e("th",[t._v("数量")])])]),e("thead",[e("tr",{staticClass:"border"},[e("td",[t._v("#")]),e("td",[t._v(" 损耗")]),e("td",[t._v("\n                                        "+t._s(a.worstWidth)+"\n                                    ")])])]),e("tbody",t._l(a.sub_child_solver,(function(a,s){return e("tr",{key:s},[e("td",[t._v(t._s(s+1))]),e("td",[t._v("\n                                        "+t._s(a.width)+"\n                                    ")]),e("td",[t._v("\n                                        "+t._s(a.quantity)+"\n                                    ")])])})),0)]),e("div",{staticClass:"text-center",staticStyle:{"margin-top":"-10px","z-index":"1"}},[e("pages-btn",{attrs:{color:a.select?"success":"info",small:"",depressed:"","min-width":"50"},on:{click:function(e){return t.selectdRow(s)}}},[t._v("\n                                "+t._s("选我")+"\n                            ")])],1)],1)})),1)],1)],1),e(r["a"],{attrs:{cols:"1"}})],1):t._e(),e(p["a"],{staticStyle:{"margin-top":"-40px"}},[e(r["a"],{attrs:{cols:"1"}}),e(r["a"],{attrs:{cols:"10",md:"10"}},[e("base-material-card",{staticClass:"px-5 py-3",attrs:{color:"pink",icon:"mdi-format-line-style",title:"分割方案",text:"<span color='white'><b>分割方案</b></span>"}},[e(_["a"],[e("thead",[e("tr",[e("th",{attrs:{width:"4%"}},[t._v("#")]),e("th",[e("b",[t._v("有效宽度")])]),e("th",[e("b",[t._v("有效重量")])]),e("th",[e("b",[t._v("使用率")])]),e("th",[e("b",[t._v("损耗宽度")])]),e("th",[e("b",[t._v("损耗重量")])]),e("th",{attrs:{width:"50%"}},[e("b",[t._v("明细(规格*数量/重量)")])])])]),t.mode_data.result?e("tbody",t._l(t.mode_data.result.solutions,(function(a,s){return e("tr",{key:s},[e("td",[t._v(t._s(s+1))]),e("td",[t._v("\n                                "+t._s(a[4])+"\n                            ")]),e("td",[t._v("\n                                "+t._s(a[5])+"\n                            ")]),e("td",[t._v("\n                                "+t._s(t.getPercentageUtilization(a[0],a[1]))+"%\n                            ")]),e("td",[t._v("\n                                "+t._s(a[0])+"\n                            ")]),e("td",[t._v("\n                                "+t._s(a[2])+"\n                            ")]),e("td",[t._v("\n                                "+t._s(a[3].join(","))+"\n                            ")])])})),0):t._e()]),e(p["a"],{staticClass:"text-right"},[e(r["a"],{attrs:{cols:"5"}}),e(r["a"],{attrs:{cols:"3"}},[e(i["a"],{staticClass:"pl-0 text-right"},[e(s["a"],{attrs:{color:"success",disabled:t.cutBtnDisabled},on:{click:function(e){return t.downloadCsv()}}},[t._v("\n                                下载\n                            ")])],1)],1),e(r["a"],{attrs:{cols:"4"}})],1),e(p["a"],{staticStyle:{"margin-top":"-20px"}},[e(r["a"],{attrs:{cols:"11"}},[e("div",{attrs:{id:"d3_area"}},[e("svg",{staticStyle:{height:"100"}})])])],1)],1)],1),e(r["a"],{attrs:{cols:"1"}})],1),e("base-material-snackbar",t._b({attrs:{timeout:2e3,type:t.color},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},"base-material-snackbar",{top:!0,center:!0},!1),[e("span",{staticClass:"font-weight-bold"},[t._v(t._s(t.snackbarMsg))])]),e(d["a"],{attrs:{scrim:!1,persistent:"",width:"auto"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e(o["a"],{attrs:{color:"success"}},[e(i["b"],[e("span",{staticClass:"white--text font-weight-bold"},[e("b",[t._v("请稍后，计算中...")])]),e(u["a"],{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),e(d["a"],{attrs:{scrollable:"",width:"400"},model:{value:t.dialogSelect,callback:function(e){t.dialogSelect=e},expression:"dialogSelect"}},[e(o["a"],[e(g["a"],{attrs:{color:"info"}},[e(w["a"],[t._v("选择常用规格")]),e(f["a"]),e(s["a"],{staticClass:"px-2 ml-1",attrs:{small:"",color:"info",variant:"text"},on:{click:function(e){t.dialogAdd=!0}}},[e(h["a"],{attrs:{color:"white"}},[t._v("mdi-plus")])],1)],1),e(c["a"]),e(n["a"],{attrs:{headers:t.headers,items:t.selections,"hide-default-footer":"","show-select":""},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),e(c["a"]),e(i["a"],[e(s["a"],{attrs:{color:"success",variant:"text"},on:{click:function(e){return t.selectedSpec()}}},[t._v("\n                    确定\n                ")]),e(s["a"],{attrs:{color:"blue-darken-1",variant:"text"},on:{click:function(e){t.dialogSelect=!1}}},[t._v("\n                    关闭\n                ")]),e(f["a"]),e(s["a"],{attrs:{color:"error",align:"right",variant:"text"},on:{click:function(e){return t.delSpec()}}},[t._v("\n                    删除\n                ")])],1)],1)],1),e(d["a"],{attrs:{scrollable:"",width:"300"},model:{value:t.dialogAdd,callback:function(e){t.dialogAdd=e},expression:"dialogAdd"}},[e(o["a"],[e(g["a"],{attrs:{color:"info"}},[e(w["a"],[t._v("添加常用规格")]),e(f["a"])],1),e(c["a"]),e(p["a"],[e(r["a"],{attrs:{cols:"1"}}),e(r["a"],{attrs:{cols:"10"}},[e(m["a"],{attrs:{width:"80%",label:"长度",color:"secondary",type:"number"},model:{value:t.addSpecInfo.length,callback:function(e){t.$set(t.addSpecInfo,"length",e)},expression:"addSpecInfo.length"}}),e(m["a"],{attrs:{width:"80%",label:"重量",color:"secondary",type:"number"},model:{value:t.addSpecInfo.weight,callback:function(e){t.$set(t.addSpecInfo,"weight",e)},expression:"addSpecInfo.weight"}})],1),e(r["a"],{attrs:{cols:"1"}})],1),e(c["a"]),e(i["a"],[e(s["a"],{attrs:{color:"success",variant:"text"},on:{click:function(e){return t.addSpec()}}},[t._v("\n                    添加\n                ")]),e(s["a"],{attrs:{color:"blue-darken-1",variant:"text"},on:{click:function(e){t.dialogAdd=!1}}},[t._v("\n                    关闭\n                ")])],1)],1)],1)],1)},v=[],y=a("898b"),x=a("7c15"),k={name:"OptiOnePage",components:{PagesBtn:()=>a.e("chunk-2d22e0db").then(a.bind(null,"f9b4"))},data:()=>({cutRules:!1,dialogAdd:!1,dialogSelect:!1,dialog:!1,selectedSolIndex:!1,cutBtnDisabled:!1,side:0,cutWidth:0,percent:99,number:0,snackbar:!1,color:"info",snackbarMsg:"",colors:["#f1c40f","#1abc9c","#f39c12","#2ecc71","#27ae60","#e67e22","#d35400","#16a085","#3498db","#2980b9","#e74c3c","#c0392b","#9b59b6","#8e44ad","#ecf0f1","#bdc3c7","#95a5a6","#34495e","#2c3e50"],wasteColor:"#7f8c8d",mode_data:{childs:[{width:0,quantity:0,weight:0}],parents:[{width:0,quantity:0,weight:0}],result:null,childs_for_select:null},headers:[{text:"长度",value:"length"},{text:"重量",value:"weight"}],selections:[],selected:[],addSpecInfo:{spec_type:"ParentOne",length:0,width:0,weight:0}}),created(){this.$vuetify.theme.dark=!1},beforeDestroy(){this.$vuetify.theme.dark=!0},methods:{getPercentageUtilization:function(t,e){let a=t;e.forEach(t=>{a+=t});let s=Math.abs(a-t),o=100*s/a;return o*=100,o=Math.round(o),o/=100,o},hoverPlan(t){console.log(t);let e=0;this.childs_for_select.forEach(a=>{a.select=t===e,e++})},selectdRow:function(t){this.selectedSolIndex=!0;let e=this.mode_data.childs_for_select[t];console.log(e);for(let o=0;o<e.sub_child_solver.length;o++){const t=e.sub_child_solver[o];this.mode_data.childs[o].quantity=t.quantity}this.rule_selectd_index=t,this.mode_data.result={data:{solutions:null,sub_weights:null}},this.mode_data.result.data.solutions=this.mode_data.childs_for_select[t].solutions.solutions,this.mode_data.result.data.sub_weights=this.mode_data.childs_for_select[t].solutions.sub_weights;let a=[];this.mode_data.result.data.solutions.forEach(t=>{let e=[];t.subs.forEach(t=>{e.push(Math.round(parseFloat(t))/1e3)});let s=[];t.sub_weights.forEach(t=>{s.push(Math.round(parseFloat(t))/1e3)});let o=Math.round(parseFloat(t.parent_length))/1e3,i=Math.round(parseFloat(t.parent_weight))/1e3;a.push([parseFloat(t.un_used/1e3),e,parseFloat(t.un_used_weight/1e3),s,o,i])}),this.mode_data.result.solutions=a;let s=0;this.mode_data.result.data.sub_weights.forEach(()=>{this.mode_data.childs[s].weight=0,s+=1}),s=0,this.mode_data.result.data.sub_weights.forEach(t=>{parseFloat(this.mode_data.childs[s].weight)?this.mode_data.childs[s].weight=parseFloat(this.mode_data.childs[s].weight)+t/1e3:this.mode_data.childs[s].weight=t/1e3,s+=1}),this.draw1d()},alertErr:function(t,e){this.snackbar=!0,this.color=!0===t?"error":"info",this.snackbarMsg=e},selectSpec:function(){this.dialogSelect=!0,this.getSelections()},selectedSpec:function(){this.dialogSelect=!1,this.selected.forEach(t=>{0==this.mode_data.parents[0].width&&(this.mode_data.parents=[]),this.mode_data.parents.push({width:t.length,quantity:1,weight:t.weight})})},addSpec:function(){this.addSpecInfo.length=parseFloat(this.addSpecInfo.length),this.addSpecInfo.weight=parseFloat(this.addSpecInfo.weight),Object(x["i"])(this.addSpecInfo).then(t=>{if(this.dialogAdd=!1,0==t.code)return this.getSelections(),void(this.selected=[]);this.alertErr(!0,t.msg)}).catch(t=>(this.dialogAdd=!1,this.alertErr(!0,t.message),!1))},delSpec:function(){let t=[];this.selected.forEach(e=>{t.push(e.id)});let e={ids:t};console.log(e),Object(x["e"])(e).then(t=>{if(console.log(t),0==t.code)return this.getSelections(),void(this.selected=[]);this.alertErr(!0,t.msg)}).catch(t=>(this.alertErr(!0,t.message),!1))},prepareDataToSend1DForRule:function(){let t=[];this.mode_data.childs.forEach(e=>{t.push({width:parseInt(1e3*parseFloat(e.width))})});let e=[];return this.mode_data.parents.forEach(t=>{let a=Math.round(parseFloat(this.side)/parseFloat(t.width)*(1e3*parseFloat(t.weight)));e.push({quantity:parseInt(t.quantity),width:parseInt(1e3*parseFloat(t.width)),weight:parseInt(1e3*parseFloat(t.weight)-a)})}),{child_rolls:t,parent_rolls:e,side:parseInt(1e3*parseFloat(this.cutWidth)),out_side:parseInt(1e3*parseFloat(this.side)),seed:Math.round(10*Math.random()),percent:this.percent}},prepareDataToSend1DForWeight:function(){let t=[];this.mode_data.childs.forEach(e=>{t.push({quantity:parseInt(e.quantity),width:parseInt(1e3*parseFloat(e.width))})});let e=[];return this.mode_data.parents.forEach(t=>{let a=Math.round(parseFloat(this.side)/parseFloat(t.width)*(1e3*parseFloat(t.weight)));e.push({quantity:parseInt(t.quantity),width:1e3*parseFloat(t.width),weight:parseInt(1e3*parseFloat(t.weight)-a)})}),{child_rolls:t,parent_rolls:e,side:parseInt(1e3*parseFloat(this.cutWidth)),out_side:parseInt(1e3*parseFloat(this.side)),seed:Math.round(10*Math.random())}},disableCutBtn:function(t){this.cutBtnDisabled=t},sendCutSheet:function(){this.mode_data.childs_for_select=[],this.cutRules=!1;let t=0,e=0;for(let s=0;s<this.mode_data.parents.length;s++){const t=this.mode_data.parents[s];if(null==t.weight||0==t.weight)return this.alertErr(!0,"请输入母卷的重量！"),!1;if(null==t.width||0==t.width)return this.alertErr(!0,"请输入母卷的长度！"),!1;if(null==t.quantity||0==t.quantity)return this.alertErr(!0,"请输入母卷的数量！"),!1}for(let s=0;s<this.mode_data.childs.length;s++){const t=this.mode_data.childs[s];if(null==t.weight||0==t.weight)return this.alertErr(!0,"请输入子卷预定的重量！"),!1;if(null==t.width||0==t.width)return this.alertErr(!0,"请输入子卷的宽度！"),!1}if(this.percent<95&&this.alertErr("warning","期望最小使用率有点低哦！"),this.percent>=100)return this.alertErr("error","期望最小使用率太高了哦！做不到"),!1;this.mode_data.parents.forEach(a=>{t+=parseFloat(a.width)*parseFloat(a.quantity),e+=parseFloat(a.weight)*parseFloat(a.quantity)});for(let s=0;s<this.mode_data.childs.length;s++){const a=this.mode_data.childs[s];let o=parseFloat(a.width)/parseFloat(t)*e,i=Math.round(parseFloat(a.weight)/o);a.quantity=i}this.disableCutBtn(!0);const a=this.prepareDataToSend1DForWeight();Object(x["o"])(a).then(t=>{console.log(t),this.disableCutBtn(!1),0!=t.code?this.alertErr(!0,t.msg):this.displayResult(t)}).catch(t=>(console.log(t),this.disableCutBtn(!1),this.alertErr(!0,"连接服务失败，请检查网络"),!1))},sendCutRules:function(){this.cutRules=!0,this.disableCutBtn(!0);let t=this.prepareDataToSend1DForRule();console.log(t),this.dialog=!0,Object(x["n"])(t).then(t=>{if(console.log(t),this.disableCutBtn(!1),this.dialog=!1,0==t.code)return t.data.solutions.forEach(t=>{t.sub_child_solver.length>0&&t.sub_child_solver.forEach(t=>{t.width=t.width/1e3});let e=0;t.solutions.solutions.forEach(t=>{e+=parseFloat(t.un_used)}),t.worstWidth=e/1e3+parseFloat(this.side)}),void(this.mode_data.childs_for_select=t.data.solutions);this.alertErr(!0,t.msg)}).catch(t=>(this.disableCutBtn(!1),this.dialog=!1,this.alertErr(!0,t.message),!1))},displayResult:function(t){if(t.data&&t.data.status_name&&"Error"==t.data.status_name)return this.alertErr(!0,"服务计算超出母卷的长度，请重试！"),!1;if(this.mode_data.result=t,this.mode_data.result&&this.mode_data.result.status_name&&(this.mode_data.result.statusName=this.mode_data.result.status_name.toLowerCase()),0==this.cutRules){let t=[];this.mode_data.result.data.solutions.forEach(e=>{let a=[];e.subs.forEach(t=>{a.push(Math.round(parseFloat(t))/1e3)});let s=[];e.sub_weights.forEach(t=>{s.push(Math.round(parseFloat(t))/1e3)});let o=Math.round(parseFloat(e.parent_length))/1e3,i=Math.round(parseFloat(e.parent_weight))/1e3;t.push([parseFloat(e.un_used/1e3),a,parseFloat(e.un_used_weight/1e3),s,o,i])}),this.mode_data.result.solutions=t;let e=0;this.mode_data.result.data.sub_weights.forEach(t=>{this.mode_data.childs[e].weight=parseFloat(t/1e3),e+=1})}else{let t=[];this.mode_data.result.data.solutions.forEach(e=>{let a=[];e.solutions.solutions.forEach(t=>{t.subs.forEach(t=>{a.push(Math.round(parseFloat(t))/1e3)})});let s=[];e.solutions.solutions.forEach(t=>{t.sub_weights.forEach(t=>{s.push(Math.round(parseFloat(t))/1e3)})}),t.push([parseFloat(e.un_used/1e3),a,parseFloat(e.un_used_weight/1e3),s])}),this.mode_data.result.solutions=t}this.draw1d()},sortBigRolls:function(t){t=t.sort((function(t,e){return t[0]-e[0]}));for(let e=0;e<t.length;e++){let a=Array.from(new Set(t[e][1])),s=Array.from(new Set(t[e][1]));s.forEach((s,o)=>{let i=0,r=0;t[e][1].forEach((a,o)=>{s==a&&(i+=1,r+=t[e][3][o])}),a[o]=s+"*"+i+"/"+Math.round(1e3*parseFloat(r))/1e3}),t[e][3]=a;let o=t[e][1];o=o.sort((function(t,e){return t-e})),t[e][1]=o}return t},getColorDict:function(){const t=this.mode_data.result.solutions;let e=new Set([]);for(let o=0;o<t.length;o++){const a=t[o][1];a.forEach(t=>{e.add(t)})}let a=Array.from(e),s={};for(let o=0;o<a.length;o++)s[a[o]]=this.colors[o%this.colors.length];return s},draw1d:function(){if(this.clearTheDrawing(),!this.mode_data.result)return void console.log(`Cannot draw anything. "result" is: ${this.mode_data.result} for mode: ${this.mode}`);const t=this.mode_data.result.solutions,e=this.sortBigRolls(t);this.mode_data.result.solutions=e;const a=this.getColorDict();let s=this.mode_data.parents[0].width;this.mode_data.parents.forEach(t=>{t.width>s&&(s=t.width)});const o=document.getElementById("d3_area").clientWidth;console.log(o);let i=y["c"]().domain([0,s]).range([0,o]),r=y["b"]().domain(y["a"](e.length)).range([0,100]),l=y["d"]("#d3_area svg"),n={top:5,right:10,bottom:5,left:10},d=o-n.left-n.right,c=100-n.top-n.bottom;l.attr("width",d+n.left+n.right).attr("height",c+n.top+n.bottom).style("background-color","#f3f4f7").style("border","1px solid #f3f4f7");let h=0,u=0,p=0;for(let _=0;_<e.length;_++){const t=e[_][0],s=e[_][1];h=0,p=r(_);for(let e=0;e<s.length;e++){const t=s[e],o=i(t);u=h+o;let n=l.append("g").attr("transform",`translate(${h},${p})`);n.append("rect").attr("fill",a[t]).attr("width",o-1).attr("height",r.bandwidth()-1),n.append("text").attr("fill","white").attr("x",3).attr("y",r.bandwidth()/2).attr("dy","0.35em").text(t),h=u}if(t>0){u=h+i(t);let e=l.append("g").attr("transform",`translate(${h},${p})`);e.append("rect").attr("fill",this.wasteColor).attr("width",i(t)-1).attr("height",r.bandwidth()-1),e.append("text").attr("fill","white").attr("x",3).attr("y",r.bandwidth()/2).attr("dy","0.35em").text(Math.round(t))}}return l.node()},clearTheDrawing:function(){y["e"]("#d3_area svg > *").remove(),y["d"]("#d3_area svg").style("border","")},addRowToChilds:function(){this.mode_data.childs.push([0,0,0])},removeRowToChilds:function(t){this.mode_data.childs.splice(t,1)},addRowToParents:function(){this.mode_data.parents.push([0,0,0])},removeRowToParents:function(t){this.mode_data.parents.splice(t,1)},downloadCsv:function(){if(!this.mode_data.result||!this.mode_data.result.solutions)return void console.log("downloadCsv: bigRolls are empty..");let t=[["序号","长度","重量","使用率","损耗宽度","损耗重量","明细（规格*数量/重量）"]],e=0;const a=this.mode_data.result.solutions;for(let d=0;d<a.length;d++){const s=a[d][1];e+=s.length;const o=[d+1,a[d][4],a[d][5],this.getPercentageUtilization(a[d][0],a[d][1])+"%",a[d][0],a[d][2],a[d][3].join(",")];t.push(o)}const s="data:text/csv;charset=utf-8,"+t.map(t=>t.join(",")).join("\n");let o=encodeURI(s),i=document.createElement("a");i.setAttribute("href",o);const r=new Date,l=`${r.getFullYear()}-${r.getMonth()+1}-${r.getUTCDate()}-${r.getHours()}${r.getMinutes()}-${r.getSeconds()}`,n=`cuts_${e}_${l}.csv`;i.setAttribute("download",n),document.body.appendChild(i),i.click()},getSelections:function(){Object(x["c"])({}).then(t=>(console.log(t),0==t.code?(this.selections=[],t.data.forEach(t=>this.selections.push(t)),!1):(this.alertErr(!0,t.msg),!1))).catch(t=>(this.alertErr(!0,t.message),!1))}}},E=k,F=a("2877"),C=Object(F["a"])(E,b,v,!1,null,null,null);e["default"]=C.exports}}]);
//# sourceMappingURL=chunk-2d0b9948.023faa50.js.map